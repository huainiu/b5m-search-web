function _search(){var a=$("#search-text").val();ResultPage.toJump(_basePath+"s/Search?key="+a);}$(function(){$("#search-text").keydown(function(a){if(a.keyCode==13){_search();}});});function ResultPage(a){if(!a){return;}this.$startPrice=a.$startPrice||$("#startPrice");this.$endPrice=a.$endPrice||$("#endPrice");this.$innerSearchBtn=a.$innerSearchBtn||$("#inner-search-btn");this.$cancelFilter=a.$cancelFilter||$("#cancel-filter");this.$multSelBtn=a.$multSelBtn||$("#btn-sure");this.currentUrl=a.currentUrl;}ResultPage.prototype.init=function(){var a=this;a.$startPrice.keyup(function(){a.validatePrice(this);}).keydown(function(b){if(b&&b.keyCode==13){a.searchByPrice();}});a.$endPrice.keyup(function(){a.validatePrice(this);}).keydown(function(b){if(b&&b.keyCode==13){a.searchByPrice();}});a.$innerSearchBtn.click(function(){a.searchByPrice();});a.$cancelFilter.click(function(){var k=a.currentUrl.indexOf("?");var b=a.currentUrl.substring(0,k)+"?";var d=a.currentUrl.substring(k+1);var e=d.split("&");for(var f=0;f<e.length;f++){var l=e[f];var c=l.indexOf("=");var h=l.substring(0,c);if(h=="sprice"||h=="eprice"||h=="attrs"){continue;}var g=l.substring(c+1,l.length);b=b+h+"="+g;if(f!=e.length-1){b=b+"&";}}var j=b.substring(b.length-1,b.length);if(j=="?"||j=="&"){b=b.substring(0,b.length-1);}$(this).attr("href",b);});};ResultPage.prototype.validatePrice=function(d){var b=d.value;var c=/^[\d]+(\.[\d]*)?$/;var a=9999999;if(!c.test(b)){if(d.value){d.value=origValue;}}origValue=d.value;if(parseInt(b,"10")>parseInt(a,"10")){d.value=a;}};ResultPage.prototype.searchByPrice=function(){ResultPage.toJump(this.addPriceParamUrl());};ResultPage.prototype.addPriceParamUrl=function(){var b=this.$startPrice.val();var d=this.$endPrice.val();var c=this.currentUrl.indexOf("?");if(!b&&!d){return this.currentUrl;}if(c<0){if(b&&d){return this.currentUrl+"?sprice="+b+"&eprice="+d;}if(b){return this.currentUrl+"?sprice="+b;}if(d){return this.currentUrl+"?eprice="+d;}return this.currentUrl;}else{var a=this.getUrl(function(f,g,e){if(f!="sprice"&&f!="eprice"){e=e+f+"="+g;}else{if(f=="sprice"&&b){e=e+"sprice="+b;}else{if(f=="eprice"&&d){e=e+"eprice="+d;}}}return e;});if(a.indexOf("sprice")<0&&b){a=a+"&sprice="+b;}if(a.indexOf("eprice")<0&&d){a=a+"&eprice="+d;}return a;}};ResultPage.prototype.getAttrUrl=function(a){var b=this.getUrl(function(d,e,c){if(d=="attrs"){if(e){e=e+","+a;}}c=c+d+"="+e;return c;});if(b.indexOf("attrs")>0){return b;}if(b.indexOf("?")<0){return b+"?attrs="+a;}if(b.substring(b.length-1,b.length)=="?"){return b+"attrs="+a;}return b+"&attrs="+a;};ResultPage.prototype.getUrl=function(h){var j=this.currentUrl.indexOf("?");var a=this.currentUrl.substring(0,j)+"?";var c=this.currentUrl.substring(j+1);var d=c.split("&");for(var e=0;e<d.length;e++){var k=d[e];var b=k.indexOf("=");var g=k.substring(0,b);var f=k.substring(b+1,k.length);a=h(g,f,a);if(e!=d.length-1){a=a+"&";}}return a;};ResultPage.toJump=function(b){var c=document.createElement("a");document.body.appendChild(c);c.href=b;if(c.click){c.click();}else{try{var a=document.createEvent("Event");a.initEvent("click",true,true);c.dispatchEvent(a);}catch(d){window.localhost.href=b;}}};function searchMulti(a){ResultPage.toJump(resultPage.getAttrUrl(a));}ResultPage.prototype.showRecomand=function(b){var a=b.container;if(!b.keywords){b.maxcontaier.hide();return;}this.getRelKeywords(b.keywords,function(d){if(!d){a.parent().parent().hide();return;}var c=_basePath+"s/relGoods.html?t="+new Date().getTime();var e={title:d};Ajax.post(c,e,function(f){var g=0;$.each(f,function(j,l){var m=$("<li></li>");var h=l.Url;var k='<a href="'+h+'" target="_blank">';if(l.Picture.indexOf("b5mcdn")>0){l.Picture=l.Picture+"/140x140";}k+='<img src="'+l.Picture+'" width="140" height="140" alt="'+l.Title+'"></a>'+'<p><a href="'+h+'" target="_blank">'+l.Title+"</a></p><p>";if(l.isFreeDelivery==1){k=k+"<span>免运费</span>";}k=k+"<i>￥"+l.Price+"</i></p>";if(g<10){m.append(k).appendTo(a);}g++;});if(g==0){b.maxcontaier.hide();}});});};ResultPage.prototype.getRelKeywords=function(b,c){var a="http://s.b5m.com/allAutoFill.htm";Ajax.jsonpPost(a,{keyWord:b},function(d){var e=d.b5mo;var f=null;if(e&&e.length>0){f=e[0].value;if(f==b&&e.length>1){f=e[1].value;}}c(f);});};var Ajax={};Ajax.post=function(a,b,c){$.ajax({type:"POST",url:a,data:b,success:function(d){c(d);}});};Ajax.jsonpPost=function(a,b,c){$.ajax({url:a,async:false,dataType:"jsonp",data:b,jsonp:"jsoncallback",success:function(d){c(d);}});};